<div class="games-list-container">
  <!-- Header -->
  <div class="page-header" [@fadeInUp]>
    <div class="header-content">
      <h1>
        <mat-icon>sports_esports</mat-icon>
        Game Library
      </h1>
      <p class="subtitle">{{ totalGames }} games in your collection</p>
    </div>
    <button mat-raised-button class="btn-add-game" routerLink="/games/search">
      <mat-icon>add</mat-icon>
      Add Game
    </button>
  </div>

  <!-- Filters & Controls -->
  <div class="controls-section" [@slideInUp]>
    <div class="search-bar">
      <mat-icon>search</mat-icon>
      <input type="text" placeholder="Search games, developers, genres... (Ctrl+K)"
        [(ngModel)]="searchTerm" (ngModelChange)="onSearch()"
        #searchInput>
      @if (searchTerm) {
        <button mat-icon-button (click)="searchTerm = ''; onSearch()">
          <mat-icon>close</mat-icon>
        </button>
      }
    </div>

    <div class="filters-row">
      <div class="filter-chips">
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Status</mat-label>
          <mat-select [(ngModel)]="selectedStatus" (ngModelChange)="onFilterChange()">
            <mat-option value="">All Status</mat-option>
            @for (status of statuses; track status) {
              <mat-option [value]="status">{{ getStatusLabel(status) }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Platform</mat-label>
          <mat-select [(ngModel)]="selectedPlatform" (ngModelChange)="onFilterChange()">
            <mat-option value="">All Platforms</mat-option>
            @for (platform of platforms; track platform) {
              <mat-option [value]="platform">{{ getPlatformLabel(platform) }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Genre</mat-label>
          <mat-select [(ngModel)]="selectedGenre" (ngModelChange)="onFilterChange()">
            <mat-option value="">All Genres</mat-option>
            @for (genre of genres; track genre) {
              <mat-option [value]="genre">{{ genre }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <button mat-stroked-button class="filter-btn" [class.active]="showFavoritesOnly"
          (click)="showFavoritesOnly = !showFavoritesOnly; onFilterChange()">
          <mat-icon>{{ showFavoritesOnly ? 'favorite' : 'favorite_border' }}</mat-icon>
          Favorites
        </button>

        @if (hasActiveFilters()) {
          <button mat-button class="clear-filters-btn" (click)="clearFilters()">
            <mat-icon>clear_all</mat-icon>
            Clear
          </button>
        }
      </div>

      <div class="view-controls">
        <mat-form-field appearance="outline" class="sort-field">
          <mat-label>Sort by</mat-label>
          <mat-select [value]="currentSortOption" (selectionChange)="onSortChange($event.value)">
            @for (option of sortOptions; track option.value) {
              <mat-option [value]="option.value">{{ option.label }}</mat-option>
            }
          </mat-select>
        </mat-form-field>

        <button mat-icon-button class="sort-direction-btn" (click)="toggleSortDirection()"
          [matTooltip]="currentSortDirection === 'asc' ? 'Ascending' : 'Descending'">
          <mat-icon>{{ currentSortDirection === 'asc' ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
        </button>

        <div class="view-toggle">
          <button mat-icon-button [class.active]="viewMode === 'grid'" (click)="viewMode = 'grid'" matTooltip="Grid View">
            <mat-icon>grid_view</mat-icon>
          </button>
          <button mat-icon-button [class.active]="viewMode === 'list'" (click)="viewMode = 'list'" matTooltip="List View">
            <mat-icon>view_list</mat-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Results Count -->
  @if (!loading && filteredGames.length > 0) {
    <div class="results-info">
      Showing {{ displayGames.length }} of {{ filteredGames.length }} games
      @if (hasActiveFilters()) {
        <span class="filtered-badge">(filtered)</span>
      }
    </div>
  }

  <!-- Grid View -->
  @if (!loading && displayGames.length > 0 && viewMode === 'grid') {
    <div class="games-grid">
      @for (game of displayGames; track trackByGame($index, game)) {
        <div class="game-card" [@cardAnimation] (click)="viewGame(game.id)">
          <div class="game-cover">
            @if (game.coverImageUrl) {
              <img [src]="game.coverImageUrl" [alt]="game.title" loading="lazy">
            } @else {
              <div class="cover-placeholder">
                <mat-icon>videogame_asset</mat-icon>
              </div>
            }

            <div class="card-actions">
              <button mat-icon-button (click)="toggleFavorite($event, game)" class="action-btn favorite">
                <mat-icon>{{ game.favorite ? 'favorite' : 'favorite_border' }}</mat-icon>
              </button>
              <button mat-icon-button (click)="editGame($event, game.id)" class="action-btn edit">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button (click)="deleteGame($event, game)" class="action-btn delete">
                <mat-icon>delete</mat-icon>
              </button>
            </div>

            <div class="status-badge" [class]="getStatusColor(game.status)" 
              [matTooltip]="getStatusTooltip(game.status)">
              {{ getStatusLabel(game.status) }}
            </div>

            @if (game.rating) {
              <div class="rating-badge">
                <mat-icon>star</mat-icon>
                {{ game.rating }}
              </div>
            }

            @if (game.status === 'IN_PROGRESS' && game.completionPercentage) {
              <div class="progress-indicator">
                <div class="progress-fill" [style.width.%]="game.completionPercentage"></div>
              </div>
            }
          </div>

          <div class="game-info">
            <h3 class="game-title">{{ game.title }}</h3>
            <div class="game-meta">
              <span class="developer">{{ game.developer }}</span>
              <span class="year">{{ game.releaseYear }}</span>
            </div>
            <div class="game-tags">
              <span class="platform-tag">
                <mat-icon>{{ getPlatformIcon(game.platform || '') }}</mat-icon>
                {{ getPlatformLabel(game.platform || '') }}
              </span>
              @if (game.playtimeHours) {
                <span class="playtime-tag">
                  <mat-icon>schedule</mat-icon>
                  {{ formatPlaytime(game.playtimeHours) }}
                </span>
              }
            </div>
          </div>
        </div>
      }
    </div>
  }

  <!-- List View -->
  @if (!loading && displayGames.length > 0 && viewMode === 'list') {
    <div class="games-list">
      @for (game of displayGames; track trackByGame($index, game)) {
        <div class="game-row" [@slideInUp] (click)="viewGame(game.id)">
          <div class="row-cover">
            @if (game.coverImageUrl) {
              <img [src]="game.coverImageUrl" [alt]="game.title" loading="lazy">
            } @else {
              <div class="cover-placeholder">
                <mat-icon>videogame_asset</mat-icon>
              </div>
            }
          </div>

          <div class="row-content">
            <div class="row-main">
              <h3 class="game-title">{{ game.title }}</h3>
              <div class="game-meta">
                <span>{{ game.developer }}</span>
                <span class="separator">•</span>
                <span>{{ game.releaseYear }}</span>
                <span class="separator">•</span>
                <span>{{ game.genre }}</span>
              </div>
            </div>

            <div class="row-stats">
              <div class="stat-item">
                <mat-icon>{{ getPlatformIcon(game.platform || '') }}</mat-icon>
                <span>{{ getPlatformLabel(game.platform || '') }}</span>
              </div>
              @if (game.playtimeHours) {
                <div class="stat-item">
                  <mat-icon>schedule</mat-icon>
                  <span>{{ formatPlaytime(game.playtimeHours) }}</span>
                </div>
              }
              @if (game.rating) {
                <div class="stat-item rating">
                  <mat-icon>star</mat-icon>
                  <span>{{ game.rating }}/10</span>
                </div>
              }
            </div>

            <div class="row-status">
              <span class="status-chip" [class]="getStatusColor(game.status)">
                {{ getStatusLabel(game.status) }}
              </span>
            </div>
          </div>

          <div class="row-actions">
            <button mat-icon-button (click)="toggleFavorite($event, game)">
              <mat-icon [class.favorited]="game.favorite">{{ game.favorite ? 'favorite' : 'favorite_border' }}</mat-icon>
            </button>
            <button mat-icon-button (click)="editGame($event, game.id)">
              <mat-icon>edit</mat-icon>
            </button>
            <button mat-icon-button (click)="deleteGame($event, game)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      }
    </div>
  }

  <!-- Pagination -->
  @if (!loading && filteredGames.length > pageSize) {
    <app-custom-paginator
      [length]="totalGames"
      [pageSize]="pageSize"
      [pageSizeOptions]="pageSizeOptions"
      (page)="onPageChange($event)">
    </app-custom-paginator>
  }

  <!-- Loading State -->
  @if (loading) {
    <div class="loading-container">
      <mat-spinner diameter="48"></mat-spinner>
      <h3>Loading games...</h3>
    </div>
  }

  <!-- Empty State -->
  @if (!loading && games.length === 0) {
    <div class="empty-state" [@fadeInUp]>
      <mat-icon>sports_esports</mat-icon>
      <h2>No games yet!</h2>
      <p>Start building your collection by adding your first game.</p>
      <button mat-raised-button class="btn-add-game" routerLink="/games/new">
        <mat-icon>add</mat-icon>
        Add Your First Game
      </button>
    </div>
  }

  <!-- No Results State -->
  @if (!loading && games.length > 0 && filteredGames.length === 0) {
    <div class="empty-state" [@fadeInUp]>
      <mat-icon>search_off</mat-icon>
      <h2>No games found</h2>
      <p>Try adjusting your filters or search term.</p>
      <button mat-button class="clear-filters-btn" (click)="clearFilters()">
        <mat-icon>clear_all</mat-icon>
        Clear Filters
      </button>
    </div>
  }
</div>
